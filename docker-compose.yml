version: '3.8'

services:
  whisper-transcriber:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: whisper-transcriber
    volumes:
      # Mount directories for video input and transcript output
      - ./data/watch:/data/watch
      - ./data/transcripts:/data/transcripts
      # Optional: mount a local directory for convenience
      - ${WATCH_DIR:-./data/watch}:/data/watch
      - ${OUTPUT_DIR:-./data/transcripts}:/data/transcripts
    environment:
      # Whisper model: tiny, base, small, medium, large
      WHISPER_MODEL: ${WHISPER_MODEL:-base}
      WATCH_DIR: /data/watch
      OUTPUT_DIR: /data/transcripts
      PYTHONUNBUFFERED: 1
    restart: unless-stopped
    # Health check with helpful feedback
    healthcheck:
      test: ["CMD", "python3", "-c", "import whisper; print('âœ“ Whisper ready'); exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    # Uncomment for GPU support (requires nvidia-docker)
    # runtime: nvidia
    # environment:
    #   NVIDIA_VISIBLE_DEVICES: all
    stdin_open: true
    tty: true
    # Show helpful startup messages
    entrypoint: /bin/sh -c "echo 'ðŸŽ¤ Whisper Transcriber Starting...' && python3 /app/transcriber.py"
